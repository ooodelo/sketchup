# Point Cloud Importer for SketchUp Pro 2023

Плагин добавляет в SketchUp Pro 2023 (macOS) полноценную работу с облаками точек:

- Импорт ASCII и бинарных PLY файлов с миллионами точек.
- Визуализация через аппаратно-ускоренный overlay без создания тяжелой геометрии.
- Управление облаками через отдельный менеджер: видимость, активность, плотность отображения, размер точек.
- Интерактивный инструмент измерения расстояний между точками с выводом длины в привычных единицах SketchUp.
- Панель инструментов и команды меню Extensions → Point Cloud Importer.

## Основные возможности

### Импорт
1. Запустите команду **Extensions → Point Cloud Importer → Импорт облака точек...**.
2. Выберите PLY файл. Поддерживаются ASCII и binary little endian форматы с цветами (RGB) или без них.
3. В диалоге настройте размер и стиль точек, долю отображаемых точек в окне и ограничение по количеству точек на экран.
4. После импорта облако появится как новый слой визуализации и станет активным.

### Менеджер облаков
- Команда **Менеджер облаков...** открывает HtmlDialog с перечнем загруженных облаков.
- Слайдер плотности позволяет плавно снижать нагрузку (от 5% до 100% точек).
- Слайдер размера точек меняет визуальную толщину маркеров.
- Кнопки «Скрыть/Показать», «Активировать» и «Удалить» управляют облаком напрямую.

### Измерения
- Команда **Измерить расстояние в облаке** активирует инструмент.
- Кликните по двум точкам облака — появится линия и диалог с длиной в системных единицах модели.

### Прочие особенности
- Отрисовка выполняется через SketchUp Model Overlay, поэтому не перегружает модель миллионами объектов.
- Для поиска точки используется адаптивное KD-дерево с пониженной выборкой, что позволяет быстро находить ближайшие точки даже в облаках 5–8 млн вершин.
- Предпочтения (размер, стиль точек, лимиты отображения) сохраняются в настройках SketchUp.

## Установка
1. Скачайте или склонируйте репозиторий.
2. Поместите папку `point_cloud_importer` и файл `point_cloud_importer.rb` в каталог плагинов SketchUp (`~/Library/Application Support/SketchUp 2023/SketchUp/Plugins`).
   - Альтернатива: создайте архив `.rbz`, упаковывая `point_cloud_importer.rb` и папку `point_cloud_importer` в ZIP и переименовывая файл в `point_cloud_importer.rbz`. Затем установите его через **SketchUp → Preferences → Extensions → Install Extension...**
3. Перезапустите SketchUp. В меню Extensions появится раздел **Point Cloud Importer** и соответствующая панель инструментов.

## Структура файлов плагина
- `point_cloud_importer.rb` — регистрация расширения в SketchUp и подключение основного кода.
- `point_cloud_importer/extension.rb` — описание SketchUp::Extension, точка входа при загрузке.
- `point_cloud_importer/importer.rb` — импорт PLY, потоковое чтение и создание облака точек.
- `point_cloud_importer/point_cloud.rb` — представление облака: хранение точек, материал, фильтрация, включение/выключение.
- `point_cloud_importer/viewer_overlay.rb` — отрисовка точек через Overlay API без геометрии SketchUp.
- `point_cloud_importer/manager.rb` — менеджер облаков: список активных облаков, операции скрытия, удаления, переключения.
- `point_cloud_importer/measure_tool.rb` — инструмент измерения расстояний по облаку, работа с KD-деревом.
- `point_cloud_importer/spatial_index.rb` — реализация KD-дерева для быстрого поиска ближайших точек.
- `point_cloud_importer/ply_parser.rb` — парсер PLY (ASCII и binary little endian) с поддержкой цветов.
- `point_cloud_importer/settings.rb` — хранение и загрузка пользовательских настроек визуализации.
- `point_cloud_importer/ui/commands.rb` — регистрация команд меню и панели инструментов.
- `point_cloud_importer/ui/manager_dialog.rb` — HtmlDialog контроллер, синхронизация UI и Ruby.
- `point_cloud_importer/ui/manager_dialog.html` — интерфейс менеджера облаков на HTML/JS/CSS.

## Требования
- SketchUp Pro 2023 или новее.
- macOS.
- Объем оперативной памяти, достаточный для выбранного облака точек.

## Ограничения и рекомендации
- Для файлов с более чем 8 млн точек используйте ограничение по отображаемому количеству и плотности, чтобы удерживать отзывчивость viewport.
- Инструмент измерения проецирует позицию курсора на плоскость, проходящую через центр облака. Для сложных сцен рекомендуется приближать вид к нужной области перед измерением.
- Если исходный PLY содержит дополнительные свойства (например, интенсивность), они сохраняются в метаданных и отображаются в менеджере облаков.

## План развития
- Поддержка других форматов (E57, LAS/LAZ).
- Экспорт выбранных точек в отдельный файл.
- Расширенные фильтры: обрезка по диапазону высот и создание сечений.
